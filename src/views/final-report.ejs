<%
    // Desestructuración para facilitar el acceso a los datos
    const { recommendation, rationale, purchaseReport } = data;
%>

<%- include('layout', { body: `
    <style>
    /* Estilos CSS adaptados a Light Mode (Simulador) */
    body {
        background-color: #f4f7f9; /* Fondo muy claro, corporativo */
        color: #333; /* Texto principal oscuro */
        font-family: Arial, sans-serif;
    }
    /* Estilo de la barra superior (similar al header-simulador) */
    .header-bar {
        display: flex;
        justify-content: space-between;
        padding: 15px 40px;
        background-color: white; /* Barra superior blanca */
        border-bottom: 1px solid #e0e0e0;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }
    .title {
        font-size: 1.2em;
        font-weight: bold;
        color: #333;
    }
    .screen-name {
        font-weight: 500;
        color: #666;
    }
    .section-container {
        padding: 20px 40px;
    }
    .section-label {
        font-weight: 500;
        margin-bottom: 10px;
        color: #666; /* Texto de etiqueta gris */
        font-size: 1.1em;
    }
    
    /* Panel Destacado (Similar a un KPI o Alerta de Éxito) */
    .highlight-panel {
        background-color: #e6ffe6; /* Fondo verde muy claro (Éxito) */
        border: 2px solid #318a77; /* Borde verde principal */
        padding: 20px;
        border-radius: 8px;
        color: #333;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.08);
    }
    .scenario-title {
        margin: 0;
        font-size: 1.6em;
        color: #318a77; /* Verde principal para el título */
    }
    .financial-impact {
        font-size: 1.1em;
        color: #555;
    }
    .impact-value {
        color: #28a745; /* Verde para el impacto positivo */
        font-weight: bold;
    }
    
    .main-content-grid {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 30px;
        padding: 20px 40px;
    }
    .card {
        background-color: white; /* Fondo de tarjeta blanca */
        padding: 25px;
        border-radius: 8px;
        margin-bottom: 20px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); /* Sombra suave */
        border: 1px solid #e0e0e0;
    }
    .card-title {
        font-size: 1.3em;
        margin-top: 0;
        margin-bottom: 15px;
        color: #333;
        border-bottom: 1px solid #eee;
        padding-bottom: 10px;
    }
    .rationale-point h4 {
        margin-top: 15px;
        color: #1a73e8; /* Azul para subtítulos */
        font-weight: 600;
        font-size: 1em;
    }
    .rationale-point p {
        color: #555;
    }

    /* Estilos de tabla */
    .data-table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 20px;
        font-size: 0.9em;
    }
    .data-table th, .data-table td {
        padding: 10px;
        text-align: left;
        border-bottom: 1px solid #e0e0e0;
        color: #333;
    }
    .data-table th {
        background-color: #f0f0f0; /* Fondo de encabezado claro */
        color: #555;
    }
    .suggested-buy {
        font-weight: bold;
        color: #1a73e8; /* Azul para la sugerencia de compra */
    }

    /* Botones */
    .btn-primary {
        background-color: #318a77; /* Verde/Teal primario */
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-weight: bold;
        transition: background-color 0.3s;
    }
    .btn-primary:hover {
        background-color: #236557;
    }
    .orange-btn {
        background-color: #e08e0b; /* Naranja para el botón de exportar */
        color: white;
    }
    .orange-btn:hover {
        background-color: #cc7f00;
    }

    /* Panel de Descarga */
    .right-panel .download-box {
        background-color: #ffffff; /* Fondo blanco */
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 15px;
        display: flex;
        flex-direction: column;
        border: 1px solid #e0e0e0;
        box-shadow: 0 1px 4px rgba(0, 0, 0, 0.05);
    }
    .download-box h4 {
        margin-top: 0;
        font-size: 1.1em;
        color: #333;
    }
    .download-box p {
        margin: 2px 0;
        font-size: 0.85em;
        color: #777;
    }
    .download-link {
        align-self: flex-end;
        background-color: #1a73e8; /* Azul */
        color: white;
        padding: 8px 15px;
        text-decoration: none;
        border-radius: 4px;
        margin-top: 10px;
        font-size: 0.9em;
    }
    .download-link:hover {
        background-color: #145cb8;
    }

    /* Footer */
    .footer-bar {
        background-color: white;
        padding: 15px 40px;
        display: flex;
        justify-content: space-between;
        border-top: 1px solid #e0e0e0;
        box-shadow: 0 -2px 4px rgba(0, 0, 0, 0.05);
    }
    .footer-btn {
        background: none;
        border: 1px solid #ccc;
        color: #555;
        padding: 10px 20px;
        border-radius: 6px;
        cursor: pointer;
        transition: background-color 0.2s;
    }
    .footer-btn:hover {
        background: #f0f0f0;
    }
    .footer-btn.primary-action {
        background-color: #318a77;
        border-color: #318a77;
        color: white;
    }
    .footer-btn.primary-action:hover {
        background-color: #236557;
        border-color: #236557;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
        .main-content-grid {
            grid-template-columns: 1fr;
            padding: 20px;
        }
        .header-bar, .section-container, .footer-bar {
            padding-left: 20px;
            padding-right: 20px;
        }
    }
</style>
<div class="header-bar">
    <div class="title">TOTAL PEC</div>
    <div class="screen-name">5. Reportes y Sugerencias (Decisión Ejecutiva)</div>
</div>

<div class="section-container">
    <h3 class="section-label">Recomendación del Sistema: Plan Óptimo</h3>
    <div class="highlight-panel">
        <h2 class="scenario-title">Escenario Sugiero: 
            <span class="optimal-scenario-name">${recommendation.scenario}</span>
        </h2>
        <p class="financial-impact">
            Impacto Financiero Proyectado: 
            <span class="impact-value">${recommendation.impact}</span>
        </p>
    </div>
</div>

<div class="main-content-grid">
    <div class="left-panel">
        <div class="card analysis-card">
            <h3 class="card-title">Análisis y Racional Detallado (El Porqué)</h3>
            
            <div class="rationale-point">
                <h4>• Lógica de Selección</h4>
                <p>${rationale.selectionLogic}</p>
            </div>
            
            <div class="rationale-point">
                <h4>• Mitigación de Riesgo</h4>
                <p>${rationale.mitigation}</p>
            </div>
        </div>

        <div class="card purchase-report-card">
            <h3 class="card-title">Reporte de Sugerencia de Compras (Plan Seleccionando)</h3>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Producto (Ítem)</th>
                        <th>Stock Actual</th>
                        <th>Demanda Proyectada (Plan)</th>
                        <th>Sugerencia de Compra (Unidades)</th>
                        <th>Fecha Límite Sugerida</th>
                    </tr>
                </thead>
                <tbody>
                    ${purchaseReport.map(row => `
                        <tr>
                            <td>${row.item}</td>
                            <td>${row.stock}</td>
                            <td>${row.demand}</td>
                            <td class="suggested-buy">${row.suggestion}</td>
                            <td>${row.date}</td>
                        </tr>
                    `).join('')}
                </tbody>
            </table>
            
            <button id="exportBtn" class="btn-primary orange-btn">
                <i class="fas fa-file-export"></i> Exportar Sugerencia
            </button>
        </div>
    </div>

    <div class="right-panel">
        <h3 class="section-label">Reportes de Desempeño y Control</h3>
        
        <div class="download-box">
            <h4>Reporte Operacional Detalle de Inventario</h4>
            <p>Rotación de Días</p>
            <p>Stock Crítico</p>
            <p>Formato: Excel/PDF</p>
            <a href="/reports/export/inventory-detail" class="download-link">Descargar</a>
        </div>
        
        <div class="download-box">
            <h4>Resumen Ejecutivo de Rentabilidad</h4>
            <p>ROI Proyectado</p>
            <p>Efectividad Promociones</p>
            <p>Formato: PDF con Gráficos</p>
            <a href="/reports/export/executive-summary" class="download-link">Descargar</a>
        </div>
    </div>
</div>

<div class="footer-bar">
    <button class="footer-btn">
        <i class="fas fa-arrow-left"></i> Atrás
    </button>
    <button class="footer-btn primary-action">
        Finalizar <i class="fas fa-check"></i>
    </button>
</div>

<script>
    document.getElementById('exportBtn').addEventListener('click', () => {
        // Redirige al endpoint de exportación definido en las rutas
        window.location.href = '/reports/export/purchases';
    });
</script>
 
` }) %>
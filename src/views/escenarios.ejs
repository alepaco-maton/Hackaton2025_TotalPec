<%- include('layout', { body: `
<div class="main-content-p3">
    
    <div class="p3-header">
        <div class="header-info">
            <span class="header-title-app">Simulador de Ventas y Compras</span>
            <span class="header-user-info">Hola, Juan Perez | Gerente de L√≠nea</span>
        </div>
        
        <h1 class="p3-screen-title">P3: Configuraci√≥n Base de Simulaci√≥n</h1>
        
        <div class="file-upload-status">
            <h4 class="section-context">1. Archivo Cargado: Ventas2023_Q3.csv</h4>
            <div class="status-message">
                <span class="status-icon" style="color: #318a77; font-size: 20px;">‚úÖ</span>
                <span class="status-text">
                    <span style="font-weight: bold; color: #318a77;">√âxito de Carga:</span> Datos hist√≥ricos listos. El archivo contiene informaci√≥n de 250 √≠tems.
                </span>
            </div>
        </div>
        </div>
    <div class="p3-grid">
        
        <div class="card p3-col-1">
            <h3 class="scenario-title">Select Item & Period</h3>

            <div class="form-group search-bar">
                <input type="text" id="productSearch" placeholder="Search Product Catalog..." class="text-input-compact" style="max-width: none; width: 100%; border: 1px solid #ccc; text-align: left; padding-left: 30px;">
                <span style="position: absolute; left: 10px; top: 10px; color: #999;">üîç</span>
            </div>

            <div class="item-list" id="productList" style="max-height: 200px; overflow-y: auto; margin-bottom: 15px;">
                <div class="list-item">OUR10002030 - Brasil</div>
                <div class="list-item selected">OUR10003726 - Brasil</div>
                <div class="list-item">OUR10003812 - Brasil</div>
                <div class="list-item">BIO130350 - Argentina</div>
                <div class="list-item">OUR10003727 - Brasil</div>
                </div>

            <div class="period-selection" style="display: flex; gap: 10px; align-items: center; margin-bottom: 20px;">
                <button id="weeklyBtn" class="btn-primary active" style="flex-grow: 1; padding: 8px 10px; font-size: 14px;">Weekly Simulation</button>
                <button id="monthlyBtn" class="btn-secondary" style="flex-grow: 1; padding: 8px 10px; font-size: 14px;">Monthly Simulation</button>
            </div>
 
        </div>
        <div class="card p3-col-2">
            <h3 class="scenario-title">Historical Sales Data</h3>
            
            <div class="chart-container" style="height: 220px; background: #f9f9f9; border-radius: 8px; border: 1px solid #eee; display: flex; flex-direction: column; justify-content: space-between; padding: 10px; margin-bottom: 20px;">
                <span style="font-size: 14px; color: #555;">Weekly Sales Volume (Units)</span>
                <canvas id="salesChart" class="placeholder-chart" style="flex-grow: 1; min-height: 0;"></canvas>
                <span style="font-size: 12px; color: #aaa; text-align: right;">Jan 2023 - Dec 2023</span>
            </div>
            <h4 class="variables-heading" style="margin-top: 0;">Key Metrics</h4>
            
            <div class="key-metrics-group" style="display: flex; justify-content: space-between; gap: 10px; flex-wrap: wrap;">
                <div class="metric-item" style="flex-basis: 30%; min-width: 100px;">
                    <div id="metricTotalUnits" style="font-size: 20px; font-weight: bold; color: #333;">5,200</div>
                    <div class="help-text-small">Total Units Sold (2023)</div>
                </div>
                <div class="metric-item" style="flex-basis: 30%; min-width: 100px;">
                    <div id="metricAvgWeeklySales" style="font-size: 20px; font-weight: bold; color: #333;">100</div>
                    <div class="help-text-small">Average Weekly Sales</div>
                </div>
                <div class="metric-item" style="flex-basis: 30%; min-width: 100px; text-align: right;">
                    <div id="metricBestPeriod" class="metric-value" style="font-size: 20px; font-weight: bold; color: #333;">July-Aug</div>
                    <div class="help-text-small" style="display: flex; align-items: center; justify-content: flex-end; gap: 3px; font-style: italic;">
                        Base en historial
                        <span style="color: #1a73e8; font-size: 14px;">‚ìò</span>
                    </div>
                </div>
            </div>
            
            <hr class="divider" style="margin: 15px 0;">

            <h4 class="variables-heading">Key Metrics</h4>
            <div class="key-metrics-group" style="display: flex; justify-content: space-between; gap: 10px; flex-wrap: wrap;">
                <div class="metric-item" style="flex-basis: 30%; min-width: 100px;">
                    <div style="font-size: 20px; font-weight: bold; color: #333;">5,100</div>
                    <div class="help-text-small">Averages Sold (2023)</div>
                </div>
                <div class="metric-item" style="flex-basis: 30%; min-width: 100px;">
                    <div style="font-size: 20px; font-weight: bold; color: #333;">100</div>
                    <div class="help-text-small">Average Weekly Sales</div>
                </div>
                <div class="metric-item" style="flex-basis: 30%; min-width: 100px; text-align: right;">
                    <div style="font-size: 20px; font-weight: bold; color: #333;">July-Aug</div>
                    <div class="help-text-small" style="display: flex; align-items: center; justify-content: flex-end; gap: 3px; font-style: italic;">
                        Base en historial
                        <span style="color: #1a73e8; font-size: 14px;">‚ìò</span>
                    </div>
                </div>
            </div>

        </div>
        <div class="card p3-col-3">
            <h3 class="scenario-title">Configuraci√≥n de Escenario</h3>
            
            <div class="form-group">
                <label for="forecastHorizon" class="variables-heading">Forecast Horizon</label>
                <div class="input-with-unit">
                    <input type="number" id="forecastHorizon" value="3" class="text-input-compact" style="text-align: left; max-width: 100px; flex-grow: 0;">
                    <span class="unit">Meses</span>
                </div>
                <span class="help-text-small">Define la duraci√≥n de la simulaci√≥n de pron√≥stico.</span>
            </div>

            <div class="form-group" style="margin-top: 30px;">
                <label class="variables-heading" for="applyTrendToggle">Apply Trend & Seasonality</label>
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span class="unit">ON</span>
                    <div class="toggle-switch active" id="applyTrendToggle" style="width: 40px; height: 20px; background: #318a77; border-radius: 10px; cursor: pointer; transition: 0.3s;">
                        <div class="toggle-circle" style="width: 16px; height: 16px; background: white; border-radius: 50%; margin: 2px; transition: 0.3s; transform: translateX(20px);"></div>
                    </div>
                </div>
                <span class="help-text-small">Incluye patrones hist√≥ricos en el pron√≥stico.</span>
            </div>
            
        </div>
        </div>
    <div class="actions-footer">
        <button id="backBtn" class="btn-secondary btn-footer">
            <span style="font-size: 18px; margin-right: 5px;">‚Üê</span> Back
        </button>
        <button id="nextBtn" class="btn-primary btn-footer">
            Next: Configure Scenarios <span style="font-size: 18px; margin-left: 5px;">‚Üí</span>
        </button>
    </div>
    </div>

<style>
    /* ... (Estilos CSS existentes) ... */
    .p3-grid {
        display: grid;
        grid-template-columns: 1fr; 
        gap: 20px;
        margin-top: 20px;
    }

    .list-item {
        padding: 8px 10px;
        border-radius: 6px;
        margin-bottom: 5px;
        cursor: pointer;
        transition: background 0.2s;
    }
    .list-item:hover {
        background: #f0f0f0;
    }
    .list-item.selected {
        background: #e0f7ff;
        color: #1a73e8;
        font-weight: bold;
        border-left: 3px solid #1a73e8;
    }
    .list-item.selected:hover {
        background: #e0f7ff;
    }

    .p3-header {
        max-width: 900px;
        margin: 0 auto;
        padding-bottom: 10px;
    }
    .header-info {
        display: flex;
        justify-content: space-between;
        font-size: 14px;
        color: #555;
        margin-bottom: 5px;
    }
    .p3-screen-title {
        font-size: 30px;
        color: #333;
        margin-bottom: 15px;
    }
    .file-upload-status {
        padding: 15px;
        background: #e6ffe6;
        border-radius: 8px;
        border: 1px solid #b3ffb3;
        margin-bottom: 20px;
    }
    .status-message {
        display: flex;
        align-items: flex-start;
        gap: 10px;
    }
    .section-context {
        margin-top: 0;
        margin-bottom: 5px;
    }
    .p3-col-1, .p3-col-3 {
        min-height: 400px;
    }

    @media (min-width: 768px) {
        .p3-grid {
            grid-template-columns: 1.2fr 2fr 1fr; 
        }
        .main-content-p3 {
            max-width: 1200px;
            margin: auto;
        }
        .p3-header {
            max-width: 1200px;
        }
    }

    .toggle-switch {
        position: relative;
    }
    .toggle-switch .toggle-circle {
        position: absolute;
    }
    .toggle-switch.active {
        background: #318a77 !important;
    }
    .toggle-switch.active .toggle-circle {
        transform: translateX(20px) !important;
    }
    /* Estilo del bot√≥n 'Monthly' para que se vea secundario */
    #monthlyBtn.btn-secondary {
        background: #fff;
        color: #333;
        border: 1px solid #ccc;
    }
    /* El bot√≥n activo del per√≠odo debe ser primario */
    #weeklyBtn.active, #monthlyBtn.active {
        background: #318a77 !important;
        color: white !important;
        border-color: #318a77 !important;
    }
</style>

<script src="/js/escenarios.js"></script>
` }) %>